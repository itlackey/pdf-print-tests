/* ==========================================================================
   PAGEDJS ENGINE OVERRIDES
   PagedJS-specific workarounds and fixes for known issues
   ========================================================================== */

/* ========================================================================
   RUNNING HEADERS FIX
   PagedJS doesn't support env(pub-title), so we use string-set instead
   ======================================================================== */

/* Set publication title from the first .running-title element on the title page
   The HTML structure is:
   <section class="page title-page">
     <header class="running-header">
       <span class="running-title">Vivliostyle Kitchen Sink</span>

   We need to set pubTitle only from the title page's .running-title,
   not from chapter .running-title elements which set chapterTitle */
.title-page .running-title {
  string-set: pubTitle content();
}

/* Override chapter title to use .running-title content instead of data-chapter attr
   The base CSS has both rules:
     .running-title { string-set: chapterTitle content(); }
     [data-chapter] { string-set: chapterTitle attr(data-chapter); }

   In the base CSS, [data-chapter] comes last and wins (sets "Values").
   Vivliostyle seems to prefer .running-title content (shows "CSS Values").
   We override here to match Vivliostyle's behavior. */
.content-page .running-title {
  string-set: chapterTitle content();
}

/* Override @page :left to use string() instead of env() */
@page :left {
  @top-left {
    content: string(pubTitle);
    font-family: var(--font-serif);
    font-size: 8pt;
    font-style: italic;
    color: var(--color-muted);
  }
}

/* Ensure title page has no running headers */
@page title {
  @top-left { content: none; }
  @top-right { content: none; }
}

/* First page should also have no running headers */
@page :first {
  @top-left { content: none; }
  @top-right { content: none; }
}

/* ========================================================================
   OTHER PAGEDJS FIXES
   ======================================================================== */

/* Vivliostyle-specific media query should be ignored by PagedJS */
@media vivliostyle {
  /* This block should have no effect in PagedJS */
}

/* ========================================================================
   TAC (TOTAL AREA COVERAGE) COMPLIANCE FIXES

   Chromium-based engines (PagedJS) don't properly implement device-cmyk().
   They convert ALL colors to high-TAC CMYK values during PDF generation.
   Even medium blues like #4a7ba7 produce 400% TAC (4-plate black).

   The ONLY solution that works is using very light colors that produce
   low TAC values after Chromium's aggressive color conversion.
   ======================================================================== */

/* Title page background - pure white for TAC compliance test */
.title-page {
  background: white !important;
  color: #333333 !important;
}

/* Bleed background - hidden for TAC compliance */
.bleed-background {
  display: none !important;
}

/* Chapter badge background - light version */
.chapter-badge {
  background: linear-gradient(135deg,
    #c8d8e8 0%,    /* Light steel blue: ~50% TAC */
    #d8e4f0 100%)  /* Very light blue: ~35% TAC */
    !important;
}

/* Ghost image container - light version */
.ghost-container {
  background: linear-gradient(135deg,
    #c8d8e8 0%,
    #d0dce8 50%,
    #d8e4f0 100%)
    !important;
}
